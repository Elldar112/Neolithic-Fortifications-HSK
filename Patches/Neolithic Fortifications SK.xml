<?xml version="1.0" encoding="utf-8"?>
<Patch>

  <Operation Class="PatchOperationFindMod">
    <mods>
	  <li>Fortifications - Neolithic</li>
      <li>Fortifications - Neolithic HSK</li>
    </mods>

    <success>

      <li Class="PatchOperationSequence">
        <operations>

          <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[@Name="FT_Palisade_Base"]/designationCategory</xpath>
            <value>
              <designationCategory>Security</designationCategory>
            </value>
          </li>

          <li Class="PatchOperationAdd">
            <xpath>Defs</xpath>
            <value>
              <ArchitectSense.DesignationSubCategoryDef>
                <defName>SubCategory_FortressNeolithic</defName>
                <label>Neolithic Fortifications</label>
                <description>Primitive defenses</description>
                <order>1</order>
                <defNames>
                  <li>FT_Palisade</li>
                  <li>FT_Palisade_Embrasures</li>
                  <li>FT_Palisade_Corner</li>
                  <li>FT_CavalrySpike</li>
                  <li>FT_Ditch</li>
                  <li MayRequire="ViTech.MedievalOverhaul">Pavise</li>
                  <li MayRequire="ViTech.MedievalOverhaul">Valli</li>
                  <li MayRequire="ViTech.MedievalOverhaul">StakeWall</li>
                  <li MayRequire="ViTech.MedievalOverhaul">chevalDeFrise</li>
                </defNames>
                <designationCategory>Security</designationCategory>
                <debug>false</debug>
              </ArchitectSense.DesignationSubCategoryDef>
            </value>
          </li>
		  
		  <li Class="PatchOperationAdd">
            <xpath>Defs/ArchitectSense.DesignationSubCategoryDef[defName="SubCategory_Doors"]/defNames</xpath>
			<value>
				<li>FT_PalisadeGate</li>
                <li>FT_PalisadeDoor</li>
			</value>
          </li>

          <li Class="PatchOperationRemove">
            <xpath>Defs/ArchitectSense.DesignationSubCategoryDef[defName="SubCategory_Fortifications"]/defNames/li[1]</xpath>
          </li>

          <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="FT_Palisade" or defName="FT_Palisade_Embrasures" or defName="FT_Palisade_Corner" or defName="FT_PalisadeDoor" or defName="FT_CavalrySpike" or defName="FT_Ditch"]</xpath>
            <value>
              <researchPrerequisites>
                <li>Fortification_A1</li>
              </researchPrerequisites>
            </value>
          </li>

          <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[defName="FT_PalisadeGate"]/researchPrerequisites</xpath>
            <value>
              <researchPrerequisites>
                <li>Fortification_A1</li>
              </researchPrerequisites>
            </value>
          </li>

          <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[@Name="FT_Palisade_Base"]/building</xpath>
            <value>
              <paintable>true</paintable>
            </value>
          </li>

          <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[defName="FT_PalisadeGate"]/graphicData/texPath</xpath>
            <value>
              <texPath>FT_PalisadeDoubleDoor_Mover</texPath>
            </value>
          </li>

          <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="FT_Palisade" or defName="FT_Palisade_Embrasures" or defName="FT_Palisade_Corner"]/building/relatedBuildCommands</xpath>
            <value>
              <li>FT_PalisadeDoor</li>
              <li>FT_PalisadeGate</li>
            </value>
          </li>

          <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[defName="FT_Palisade" or defName="FT_Palisade_Corner"]/costStuffCount</xpath>
            <value>
              <costStuffCount>2</costStuffCount>
            </value>
          </li>

          <li Class="PatchOperationReplace">
            <xpath>Defs/ThingDef[defName="FT_Palisade_Embrasures"]/costStuffCount</xpath>
            <value>
              <costStuffCount>4</costStuffCount>
            </value>
          </li>

          <li Class="PatchOperationAdd">
            <xpath>Defs/ThingDef[defName="FT_Palisade_Embrasures" or defName="FT_Palisade" or defName="FT_Palisade_Corner" or defName="FT_PalisadeDoor" or defName="FT_PalisadeGate"]/building</xpath>
            <value>
              <canPlaceOverWall>true</canPlaceOverWall>
            </value>
          </li>

        </operations>
      </li>

    </success>
  </Operation>

</Patch>

